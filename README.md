# Panorama - a statistics plugin for Pelican

## Overview

**Panorama** is a [Pelican](https://github.com/getpelican/pelican) plugin to generate statistics from blog posts (number of posts per month, categories and so on) display them as beautiful charts.

No more talking, see 

- the [example page](https://github.com/romainx/panorama/blob/master/panorama/test_result/all_charts)
- a [live example](http://aubonroman.com/stats.html)

## Functional overview

Produce statistics based on posts metadata and display them by using several charts.
A set of data can only be displayed by a defined set of renderers.
The mapping between data and renderers is done by configuration.

Metadata data used:

	Title: My super title
	Date: 2010-12-03 10:20
	Category: Python
	Tags: pelican, publishing

### Posts per year

- Description: Display the number of posts per year.
- Data: A dictionary with dates as keys and the number of posts as values. 
- Renderers:
	- Bar Chart

### Posts per tag

- Description**: Display the number of posts per tag.
- Data: A dictionary with tags as keys and the number of posts as values.
- Renderers:
	- Pie chart
	- Bar Chart

## Technical overview

This plugin uses:

- The Pelican [plugins feature](http://docs.getpelican.com/en/latest/plugins.html).
- The [Python Wrapper for NVD3](https://github.com/areski/python-nvd3).

### Design

Some design elements:

- The plugin mechanisms using [blinker](https://pypi.python.org/pypi/blinker). The signal to listen to is `article_generator_finalized`.
- A `DataProducer` using metadata to produce statistical data. Several `DataProducer` are available one for each data type.
- A `DataRenderer` using statistical data to render charts. Several `DataRenderer` are available one for each rendering (chart). Each produces a `js` script stored in the Pelican output directory.
- A `DataConfigurator` to map `DataProducer` to `DataRenderer`.

Generated charts are available in the Pelican `context` and can be used by any [Jinja](http://jinja.pocoo.org/) Pelican template to be integrated in the blog (in a dedicated `stats.html` template for example). See the `test_page.html` for an example of integration.


## Installation

### Get the plugin

The most convenient way is to clone the repository, but the distribution can also be donwloaded and extracted.
The root folder of the panorama distribution will be named `PANORAMA_DIR` in the rest of this chapter.

### Install plugin dependencies

It is recommended to use virtualenv see the section "Development environment installation" for more details.

```bash
$ pip install -r requirements.txt
```

### Add NVD3 dependencies to your template

Download the following files from [NVD3](http://nvd3.org):

- `nv.d3.min.js`
- `nv.d3.css`

Download the following file from [D3JS](http://d3js.org)

- `d3.zip`

Create a `panorama` directory in `themes/<your_theme>/static/`.
Put them in this directory `themes/<your_theme>/static/panorama/` as described below

```bash
	|- d3
	|   |-- d3.js
	|   |-- d3.min.js
	|   |-- LICENSE
	|- nvd3
	|   |-- nv.d3.min.js
	|   |-- src	
	|       |-- nv.d3.css
```

### Declare the plugin in the Pelican conf

In order to load the plugin you will need to specify the location where your plugins are stored and which plugins that you want to use. Assuming this is the first time you have used plugins with Pelican you should add something similar to this:

```python
PLUGIN_PATH = 'plugins'
PLUGINS = ['panorama']
```
Note: `PLUGIN_PATH` has to refer to the location where the Panorama plugin is stored, `PANORAMA_DIR`. For example, use `../panorama/panorama` if the panorama distribution has been extrated at the same level than your Pelican site directory. It can be the absolute path to the plugin directory or the path relative to your settings file.

Next it is required to configure the `DIRECT_TEMPLATES` setting. It tells Pelican which templates are to be used directly to render content. It is necessary to add the page that will display Panorama stats, let's call it `stats.html`.

```python
DIRECT_TEMPLATES = (('index', 'tags', 'categories', 'authors', 'archives', 'stats'))
```
If you already have this setting in your configuration file, you simply need to append `stats` at the end.

### Create a template

The last step is to use data generated by Panorama in a template in order to display charts. A simple example is given in the `test_result/all_charts.html`. This page has to match the name declared in the `DIRECT_TEMPLATES` setting, so it is called `stats.html` and created in the `themes/<your_theme>/template` directory. Here is an example :

```jinja
{% extends 'base.html' %}
{% block title %}Stats - {{ super() }}{% endblock title %}
{% block content %}
<link href="/theme/panorama/nvd3/src/nv.d3.css" rel="stylesheet" />
<script src="/theme/panorama/d3/d3.min.js"></script>
<script src="/theme/panorama/nvd3/nv.d3.min.js"></script>

<section id="content" >
    <div class="body">
        <header>
          <h1>Stats</h1>
        </header>
        {% for stats in panorama_data %}
        <h2>{{ stats.name }}</h2>
        <div class="entry-content">
        {{ stats.chart.container }}
        {{ stats.chart.htmlcontent }}
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}
```

## Project Layout

- A `docs` directory containing project documentation.
- A directory named with the project's name which stores the actual Python package
- A `test` directory located in the package directory containing test code and resources

```bash
	|- LICENSE
	|- README.md
	|- TODO.md
	|- docs
	|   |-- conf.py
	|   |-- generated
	|   |-- index.rst
	|   |-- installation.rst
	|   |-- quickstart.rst
	|   |-- panorama.rst
	|   |-- history.rst
	|- panorama
	|   |-- __init__.py
	|   |-- panorama.py
	|   |-- test	
	|       |-- test_module.py
	|- requirements.txt
	|- setup.py
```

## Development environment installation

### Installing virtualenv

```bash
$ pip install virtualenv
```

Configure the `.bashrc` file

```bash
# pip should only run if there is a virtualenv currently activated
export PIP_REQUIRE_VIRTUALENV=true
# cache pip-installed packages to avoid re-downloading
export PIP_DOWNLOAD_CACHE=$HOME/.pip/cachecontent/*
```

Source the file

```bash
$ source .bashrc
```

### Creating and activating the virtual environment

```bash
$ mkdir virtualenvs
$ cd virtualenvs
$ virtualenv v_panorama
```

Activate the environment

```bash
$ source $HOME/virtualenvs/v_panorama/bin/activate
```

### Install the requirements

Go to the Git folder and install the requirements.

```bash
$ pip install -r requirements.txt
```

## Workflow

GitHub's "Issues" are used for the following:

- bug tracking
- feature requests
- planned features
- release/version management